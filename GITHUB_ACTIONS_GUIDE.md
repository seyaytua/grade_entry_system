# GitHub Actions 自動化ガイド

## 🎯 概要

このプロジェクトは GitHub Actions を使用して、Windows 用配布ファイルの自動ビルド、テスト、リリースを行います。

## 🔄 ワークフロー一覧

### 1. プルリクエスト自動テスト (`pr-test.yml`)

**トリガー**: プルリクエスト作成・更新時

**実行内容**:
- コード品質チェック (Black, isort, flake8)
- モジュールインポートテスト
- Windows ビルドテスト
- テスト結果の自動コメント

**期待される効果**:
- コード品質の維持
- ビルド可能性の事前確認
- レビュー効率の向上

### 2. 自動ビルド & リリース (`build-and-release.yml`)

**トリガー**: 
- main ブランチへのプッシュ
- タグプッシュ (`v*`)
- 手動実行

**実行内容**:
- Linux でのモジュールテスト
- Windows 環境での実行ファイルビルド
- 配布ファイル (ZIP) 作成
- タグプッシュ時の自動リリース作成

**成果物**:
- `GradeEntrySystem-Windows-{version}.zip`
- GitHub Releases への自動アップロード

### 3. 定期メンテナンス (`scheduled-maintenance.yml`)

**トリガー**: 毎週月曜日 9:00 (JST)、手動実行

**実行内容**:
- 依存関係の脆弱性チェック
- コードセキュリティ分析
- 定期ビルドテスト
- 問題発生時の自動 Issue 作成

**期待される効果**:
- セキュリティリスクの早期発見
- ビルド環境の健全性確認
- 保守性の向上

### 4. 手動リリース作成 (`manual-release.yml`)

**トリガー**: 手動実行のみ

**実行内容**:
- バージョン形式の検証
- リリース用ビルド実行
- Git タグの自動作成
- カスタムリリースノート対応

**使用場面**:
- 緊急リリース
- プレリリース作成
- リリースノートのカスタマイズ

## 🚀 使用方法

### 通常の開発フロー

1. **機能開発**
   ```bash
   git checkout -b feature/new-feature
   # 開発作業
   git push origin feature/new-feature
   ```

2. **プルリクエスト作成**
   - GitHub でプルリクエストを作成
   - 自動テストが実行される
   - テスト結果がコメントとして表示される

3. **マージ**
   - レビュー後、main ブランチにマージ
   - 自動的に Windows 配布ファイルがビルドされる

### リリース作成

#### 方法1: 自動リリース (推奨)
```bash
# セマンティックバージョニングでタグを作成
git tag v1.0.0
git push origin v1.0.0
```

#### 方法2: 手動リリース
1. GitHub の Actions タブを開く
2. "手動リリース作成" を選択
3. バージョンとリリースノートを入力
4. "Run workflow" をクリック

## 📋 設定詳細

### 必要な権限

GitHub Actions が正常に動作するために以下の権限が必要です：

- `contents: write` - リリース作成、タグ操作
- `issues: write` - Issue 作成 (メンテナンス時)
- `pull-requests: write` - PR コメント

### 環境変数・シークレット

現在は標準の `GITHUB_TOKEN` のみ使用。追加のシークレットは不要です。

### アーティファクト保持期間

- **配布ファイル**: 30日間
- **セキュリティレポート**: 30日間  
- **メンテナンスレポート**: 90日間

## 🔧 カスタマイズ

### ビルド設定の変更

`grade_entry_system.spec` を編集：
```python
# 除外するライブラリを追加
excludes=[
    'new_unused_library',
],
```

### テスト項目の追加

`pr-test.yml` の `lint-and-test` ジョブに追加：
```yaml
- name: 新しいテスト
  run: |
    python -m pytest tests/
```

### 通知設定

Slack や Discord への通知を追加する場合：
```yaml
- name: Slack 通知
  uses: 8398a7/action-slack@v3
  with:
    status: ${{ job.status }}
  env:
    SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
```

## 🐛 トラブルシューティング

### よくある問題

#### 1. Windows ビルドが失敗する
- **原因**: 依存関係の問題、PyInstaller 設定エラー
- **確認**: Windows ビルドテストのログを確認
- **対処**: `grade_entry_system.spec` の hiddenimports を確認

#### 2. テストが通らない
- **原因**: コード品質問題、インポートエラー
- **確認**: PR の自動コメントを確認
- **対処**: flake8, black, isort でコードを修正

#### 3. リリースが作成されない
- **原因**: タグ形式エラー、権限不足
- **確認**: Actions の実行ログを確認
- **対処**: セマンティックバージョニング形式 (`v1.0.0`) を使用

### デバッグ方法

1. **ローカルでのテスト**
   ```bash
   # コード品質チェック
   black --check .
   isort --check-only .
   flake8 .
   
   # ビルドテスト
   python test_before_build.py
   ```

2. **Actions ログの確認**
   - GitHub の Actions タブでログを確認
   - 失敗したステップの詳細を確認

3. **アーティファクトの確認**
   - ビルド成果物をダウンロードして確認
   - レポートファイルで詳細を確認

## 📊 監視とメンテナンス

### 定期的に確認すべき項目

- [ ] セキュリティアラートの確認
- [ ] 依存関係の更新状況
- [ ] ビルドサイズの変化
- [ ] アクション実行時間の変化

### 推奨メンテナンス

- **月1回**: 依存関係の手動確認と更新
- **四半期に1回**: ワークフロー設定の見直し
- **半年に1回**: Python バージョンの更新検討

---

## 💡 ベストプラクティス

1. **セマンティックバージョニング** を遵守
2. **プルリクエスト** での開発を徹底
3. **テスト失敗時** は必ず修正してからマージ
4. **リリースノート** を適切に記載
5. **セキュリティアラート** に迅速に対応

このガイドに従って GitHub Actions を活用することで、効率的で信頼性の高い開発・配布プロセスを実現できます。